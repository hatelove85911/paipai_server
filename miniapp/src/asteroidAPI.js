!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.asteroid=t():e.asteroid=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(4);e.exports=r},function(e,t,n){var r;(function(){"use strict";function t(){}function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}var u=t.prototype,c=this,s=c.EventEmitter;u.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},u.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},u.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},u.addListener=function(e,t){var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&o(r[n],t)===-1&&r[n].push(i?t:{listener:t,once:!1});return this},u.on=i("addListener"),u.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},u.once=i("addOnceListener"),u.defineEvent=function(e){return this.getListeners(e),this},u.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},u.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&(n=o(i[r],t),n!==-1&&i[r].splice(n,1));return this},u.off=i("removeListener"),u.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},u.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},u.manipulateListeners=function(e,t,n){var r,o,i=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(o=t[r])&&("function"==typeof o?i.call(this,r,o):u.call(this,r,o));return this},u.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},u.removeAllListeners=i("removeEvent"),u.emitEvent=function(e,t){var n,r,o,i,u,c=this.getListenersAsObject(e);for(i in c)if(c.hasOwnProperty(i))for(n=c[i].slice(0),o=n.length;o--;)r=n[o],r.once===!0&&this.removeListener(e,r.listener),u=r.listener.apply(this,t||[]),u===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},u.trigger=i("emitEvent"),u.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},u.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},u._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},u._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return c.EventEmitter=s,t},r=function(){return t}.call(c,n,c,e),!(void 0!==r&&(e.exports=r))}).call(this)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){var t=e.id,n=e.token;return this.userId=t,this.loggedIn=!0,s.set(this.endpoint+"__login_token__",n).then(this.emit.bind(this,"loggedIn",t)).then(function(){return t})}function i(){return this.userId=null,this.loggedIn=!1,s.del(this.endpoint+"__login_token__").then(this.emit.bind(this,"loggedOut")).then(function(){return null})}function u(){return s.get(this.endpoint+"__login_token__").then(function(e){if(!e)throw new Error("No login token");return{resume:e}}).then(this.login.bind(this))["catch"](i.bind(this))}Object.defineProperty(t,"__esModule",{value:!0}),t.onLogin=o,t.onLogout=i,t.resumeLogin=u;var c=n(11),s=r(c)},function(e,t){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function r(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function o(e,t){return function(n){return e(t(n))}}function i(e,t){var n=q(e)||v(e)?r(e.length,String):[],o=n.length,i=!!o;for(var u in e)!t&&!A.call(e,u)||i&&("length"==u||l(u,o))||n.push(u);return n}function u(e,t,n){var r=e[t];A.call(e,t)&&p(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function c(e){if(!h(e))return x(e);var t=[];for(var n in Object(e))A.call(e,n)&&"constructor"!=n&&t.push(n);return t}function s(e,t){return t=R(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=R(r.length-t,0),u=Array(i);++o<i;)u[o]=r[t+o];o=-1;for(var c=Array(t+1);++o<t;)c[o]=r[o];return c[t]=u,n(e,this,c)}}function a(e,t,n,r){n||(n={});for(var o=-1,i=t.length;++o<i;){var c=t[o],s=r?r(n[c],e[c],c,n,e):void 0;u(n,c,void 0===s?e[c]:s)}return n}function f(e){return s(function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,u=o>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,u&&d(n[0],n[1],u)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var c=n[r];c&&e(t,c,r,i)}return t})}function l(e,t){return t=null==t?k:t,!!t&&("number"==typeof e||L.test(e))&&e>-1&&e%1==0&&e<t}function d(e,t,n){if(!_(n))return!1;var r=typeof t;return!!("number"==r?y(n)&&l(t,n.length):"string"==r&&t in n)&&p(n[t],e)}function h(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||E;return e===n}function p(e,t){return e===t||e!==e&&t!==t}function v(e){return g(e)&&A.call(e,"callee")&&(!M.call(e,"callee")||I.call(e)==j)}function y(e){return null!=e&&m(e.length)&&!b(e)}function g(e){return O(e)&&y(e)}function b(e){var t=_(e)?I.call(e):"";return t==P||t==S}function m(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function _(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function O(e){return!!e&&"object"==typeof e}function w(e){return y(e)?i(e):c(e)}var k=9007199254740991,j="[object Arguments]",P="[object Function]",S="[object GeneratorFunction]",L=/^(?:0|[1-9]\d*)$/,E=Object.prototype,A=E.hasOwnProperty,I=E.toString,M=E.propertyIsEnumerable,x=o(Object.keys,Object),R=Math.max,C=!M.call({valueOf:1},"valueOf"),q=Array.isArray,Q=f(function(e,t){if(C||h(t)||y(t))return void a(t,w(t),e);for(var n in t)A.call(t,n)&&u(e,n,t[n])});e.exports=Q},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function u(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=[d,y,_,p,b].concat(e),n=function(){var e=this,n=arguments;t.forEach(function(t){var r=t.init;return r&&r.apply(e,n)})};return n.prototype=Object.create(f["default"].prototype),n.prototype.constructor=n,s["default"].apply(void 0,[n.prototype].concat(i(t))),delete n.prototype.init,n}Object.defineProperty(t,"__esModule",{value:!0}),t.createClass=u;var c=n(3),s=o(c),a=n(1),f=o(a),l=n(5),d=r(l),h=n(6),p=r(h),v=n(7),y=r(v),g=n(8),b=r(g),m=n(9),_=r(m)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){this.ddp.connect()}function i(){this.ddp.disconnect()}function u(e){var t=this,n=e.endpoint,r=e.SocketConstructor,o=void 0===r?WebSocket:r,i=e.autoConnect,u=e.autoReconnect,c=e.reconnectInterval;this.endpoint=n;var a={endpoint:n,SocketConstructor:o,autoConnect:i,autoReconnect:u,reconnectInterval:c};this.ddp=new s["default"](a).on("connected",function(){return t.emit("connected")}).on("disconnected",function(){return t.emit("disconnected")})}Object.defineProperty(t,"__esModule",{value:!0}),t.connect=o,t.disconnect=i,t.init=u;var c=n(13),s=r(c)},function(e,t,n){"use strict";function r(e){return this.call("login",e).then(u.onLogin.bind(this))}function o(){return this.call("logout").then(u.onLogout.bind(this))}function i(){this.userId=null,this.loggedIn=!1,this.ddp.on("connected",u.resumeLogin.bind(this))}Object.defineProperty(t,"__esModule",{value:!0}),t.login=r,t.logout=o,t.init=i;var u=n(2)},function(e,t){"use strict";function n(e,t){var n=this;return new Promise(function(r,o){var i=n.ddp.method(e,t);n.methods.cache[i]={resolve:r,reject:o}})}function r(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.apply(e,n)}function o(){var e=this;this.methods={cache:{}},this.ddp.on("result",function(t){var n=t.id,r=t.error,o=t.result,i=e.methods.cache[n];r?i.reject(r):i.resolve(o),delete e.methods.cache[n]})}Object.defineProperty(t,"__esModule",{value:!0}),t.apply=n,t.call=r,t.init=o},function(e,t,n){"use strict";function r(e){var t=e.username,n=e.email,r=e.password,o={password:r,user:{username:t,email:n}};return this.call("createUser",o).then(i.onLogin.bind(this))}function o(e){var t=e.username,n=e.email,r=e.password,o={password:r,user:{username:t,email:n}};return this.call("login",o).then(i.onLogin.bind(this))}Object.defineProperty(t,"__esModule",{value:!0}),t.createUser=r,t.loginWithPassword=o;var i=n(2)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e){var t=e.id,n=e.name,r=e.params,i=e.stillInQueue;i||(this.subscriptions.cache.del(t),this.subscribe.apply(this,[n].concat(o(r))))}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=(0,y["default"])(e,n),i=this.subscriptions.cache.get(o);if(!i){var u=this.ddp.sub(e,n),c="connected"!==this.ddp.status;i=(0,f["default"])(new d["default"],{fingerprint:o,id:u,name:e,params:n,stillInQueue:c}),this.subscriptions.cache.add(i)}return i}function c(e){this.ddp.unsub(e)}function s(){var e=this;this.subscriptions={cache:new p["default"]},this.ddp.on("ready",function(t){var n=t.subs;n.forEach(function(t){e.subscriptions.cache.get(t).emit("ready")})}).on("nosub",function(t){var n=t.error,r=t.id;n&&e.subscriptions.cache.get(r).emit("error",n),e.subscriptions.cache.del(r)}).on("connected",function(){e.subscriptions.cache.forEach(i.bind(e))})}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribe=u,t.unsubscribe=c,t.init=s;var a=n(3),f=r(a),l=n(1),d=r(l),h=n(12),p=r(h),v=n(10),y=r(v)},function(e,t){"use strict";function n(e,t){return JSON.stringify({name:e,params:t})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return new Promise(function(t,n){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.get(e,function(n){return t(n[e])}):"undefined"!=typeof localStorage?t(localStorage[e]):"undefined"!=typeof AsyncStorage?AsyncStorage.getItem(e,function(e,r){e?n(e):t(r)}):t(u[e])})}function o(e,t){return new Promise(function(r,o){if("undefined"!=typeof chrome&&chrome.storage){var i=n({},e,t);chrome.storage.local.set(i,r)}else"undefined"!=typeof localStorage?(localStorage[e]=t,r()):"undefined"!=typeof AsyncStorage?AsyncStorage.setItem(e,t,function(e){e?o(e):r()}):(u[e]=t,r())})}function i(e){return new Promise(function(t,n){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.remove(e,t):"undefined"!=typeof localStorage?(delete localStorage[e],t()):"undefined"!=typeof AsyncStorage?AsyncStorage.removeItem(e,function(e){e?n(e):t()}):(delete u[e],t())})}Object.defineProperty(t,"__esModule",{value:!0}),t.get=r,t.set=o,t.del=i;var u={}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e),this.byFingerprint={},this.byId={}}return r(e,[{key:"add",value:function(e){this.byFingerprint[e.fingerprint]=e,this.byId[e.id]=e}},{key:"get",value:function(e){return this.byId[e]||this.byFingerprint[e]||null}},{key:"del",value:function(e){var t=this.get(e)||{};delete this.byFingerprint[t.fingerprint],delete this.byId[t.id]}},{key:"forEach",value:function(e){var t=this;Object.keys(this.byId).forEach(function(n){e(t.byId[n])})}}]),e}();t["default"]=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function _(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:_(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},a=n(1),f=r(a),l=n(14),d=r(l),h=n(15),p=r(h),v=n(16),y="1",g=["ready","nosub","added","changed","removed","result","updated","error"],b=1e4,m=function(e){function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.status="disconnected",n.autoConnect=e.autoConnect!==!1,n.autoReconnect=e.autoReconnect!==!1,n.reconnectInterval=e.reconnectInterval||b,n.messageQueue=new d["default"](function(e){return"connected"===n.status&&(n.socket.send(e),!0)}),n.socket=new p["default"](e.SocketConstructor,e.endpoint),n.socket.on("open",function(){n.socket.send({msg:"connect",version:y,support:[y]})}),n.socket.on("close",function(){n.status="disconnected",n.messageQueue.empty(),n.emit("disconnected"),n.autoReconnect&&setTimeout(n.socket.open.bind(n.socket),n.reconnectInterval)}),n.socket.on("message:in",function(e){"connected"===e.msg?(n.status="connected",n.messageQueue.process(),n.emit("connected")):"ping"===e.msg?n.socket.send({msg:"pong",id:e.id}):(0,v.contains)(g,e.msg)&&n.emit(e.msg,e)}),n.autoConnect&&n.connect(),n}return u(t,e),c(t,[{key:"emit",value:function(){var e;setTimeout((e=s(Object.getPrototypeOf(t.prototype),"emit",this)).bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))),0)}}]),c(t,[{key:"connect",value:function(){this.socket.open()}},{key:"disconnect",value:function(){this.autoReconnect=!1,this.socket.close()}},{key:"method",value:function(e,t){var n=(0,v.uniqueId)();return this.messageQueue.push({msg:"method",id:n,method:e,params:t}),n}},{key:"sub",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return n||(n=(0,v.uniqueId)()),this.messageQueue.push({msg:"sub",id:n,name:e,params:t}),n}},{key:"unsub",value:function(e){return this.messageQueue.push({msg:"unsub",id:e}),e}}]),t}(f["default"]);t["default"]=m},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.consumer=t,this.queue=[]}return r(e,[{key:"push",value:function(e){this.queue.push(e),this.process()}},{key:"process",value:function(){if(0!==this.queue.length){var e=this.consumer(this.queue[0]);e&&(this.queue.shift(),this.process())}}},{key:"empty",value:function(){this.queue=[]}}]),e}();t["default"]=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),a=r(s),f=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r.SocketConstructor=e,r.endpoint=n,r.rawSocket=null,r}return u(t,e),c(t,[{key:"send",value:function(e){var t=JSON.stringify(e);this.rawSocket.send(t),this.emit("message:out",JSON.parse(t))}},{key:"open",value:function(){var e=this;this.rawSocket||(this.rawSocket=new this.SocketConstructor(this.endpoint),this.rawSocket.onopen=function(){return e.emit("open")},this.rawSocket.onclose=function(){e.rawSocket=null,e.emit("close")},this.rawSocket.onerror=function(){delete e.rawSocket.onclose,e.rawSocket.close(),e.rawSocket=null,e.emit("close")},this.rawSocket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(r){return}e.emit("message:in",n)})}},{key:"close",value:function(){this.rawSocket&&this.rawSocket.close()}}]),t}(a["default"]);t["default"]=f},function(e,t){"use strict";function n(){return(o++).toString()}function r(e,t){return e.indexOf(t)!==-1}Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueId=n,t.contains=r;var o=0}])});